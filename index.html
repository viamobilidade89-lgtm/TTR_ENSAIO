<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALPHA | Engenharia de Campo</title>
    <style>
        :root {
            --bg: #0a0f18;
            --card-bg: rgba(30, 41, 59, 0.7);
            --primary: #38bdf8;
            --accent: #818cf8;
            --success: #10b981;
            --error: #f43f5e;
            --text: #f1f5f9;
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 30px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .nav-card {
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .nav-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            background: rgba(56, 189, 248, 0.1);
        }

        .section { display: none; padding: 25px; margin-bottom: 20px; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .field { display: flex; flex-direction: column; gap: 8px; }
        label { font-size: 0.75rem; font-weight: 700; color: var(--primary); text-transform: uppercase; letter-spacing: 0.5px; }

        input, select {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--border);
            padding: 12px;
            border-radius: 8px;
            color: white;
            outline: none;
            transition: 0.3s;
        }

        input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2); }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; overflow: hidden; border-radius: 8px; }
        th { background: rgba(56, 189, 248, 0.1); color: var(--primary); padding: 12px; font-size: 0.8rem; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid var(--border); text-align: center; font-size: 0.9rem; }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary { background: var(--primary); color: #000; }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-danger { background: rgba(244, 63, 94, 0.1); color: var(--error); border: 1px solid var(--error); }

        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 800; }
        .badge-ok { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .badge-err { background: rgba(244, 63, 94, 0.2); color: var(--error); }

        @media print {
            .no-print { display: none !important; }
            body { background: white; color: black; }
            .section { display: block !important; border: 1px solid #eee; margin-bottom: 40px; page-break-inside: avoid; }
            .glass { border: none; box-shadow: none; background: white; }
            th { background: #f8fafc !important; color: black !important; border: 1px solid #ddd; }
            td { border: 1px solid #ddd; color: black; }
            .logo { -webkit-text-fill-color: black; }
        }
    </style>
</head>
<body>

<div class="container">
    <header class="no-print">
        <div class="logo">ALPHA // ENGINEERING</div>
        <button class="btn btn-outline" onclick="abrirS('CONFIG')">‚öôÔ∏è</button>
    </header>

    <div class="glass section" style="display: block;" id="cabecalho">
        <label style="margin-bottom: 15px; display: block; font-size: 1rem;">üìã Informa√ß√µes do Ensaio</label>
        <div class="input-group">
            <div class="field"><label>T√©cnico</label><select id="cliTec" class="setTec"></select></div>
            <div class="field"><label>Localiza√ß√£o</label><select id="cliLoc" class="setLoc"></select></div>
            <div class="field"><label>Equipamento / TAG</label><input type="text" id="cliEqp" placeholder="Ex: TRAFO-01"></div>
            <div class="field"><label>Data</label><input type="date" id="cliData"></div>
        </div>
    </div>

    <nav class="nav-grid no-print">
        <div class="glass nav-card" onclick="abrirS('TTR')">‚ö° TTR</div>
        <div class="glass nav-card" onclick="abrirS('MEG')">üõ°Ô∏è MEG√îMETRO</div>
        <div class="glass nav-card" onclick="abrirS('MIC')">üîç MICRO</div>
        <div class="glass nav-card" onclick="abrirS('HIST')" style="color: var(--primary);">üìú HIST√ìRICO</div>
    </nav>

    <div id="secTTR" class="glass section">
        <div class="input-group">
            <div class="field"><label>Tens√£o Prim√°ria (V)</label><input type="number" id="ttrU1" oninput="runTTR()"></div>
            <div class="field"><label>Tens√£o Secund√°ria (V)</label><input type="number" id="ttrU2" oninput="runTTR()"></div>
            <div class="field">
                <label>Grupo de Liga√ß√£o</label>
                <select id="ttrGrp" onchange="initTTR()">
                    <option value="">Selecione...</option>
                    <option value="Ydn">Ydn (1 ou 11)</option>
                    <option value="Dyn">Dyn (1 ou 11)</option>
                    <option value="Ynyn">Ynyn0</option>
                    <option value="Dd">Dd0 / Yy0</option>
                </select>
            </div>
        </div>
        <div id="ttrDisplay" style="text-align: center; margin: 20px 0; color: var(--primary); font-size: 1.2rem; font-weight: 800;"></div>
        <table>
            <thead><tr><th>Fase</th><th>Medido</th><th>Desvio %</th><th>Status</th></tr></thead>
            <tbody id="ttrCorpo"></tbody>
        </table>
    </div>

    <div id="secMEG" class="glass section">
        <div class="input-group">
            <div class="field"><label>Ponto</label>
                <select id="megPonto">
                    <option>PRI x SEC</option><option>PRI x TERRA</option><option>SEC x TERRA</option>
                </select>
            </div>
            <div class="field"><label>Tens√£o (V)</label><input type="number" id="megV" value="5000"></div>
            <div class="field"><label>30s (GŒ©)</label><input type="number" id="meg30"></div>
            <div class="field"><label>60s (GŒ©)</label><input type="number" id="meg60"></div>
            <div class="field"><label>120s (GŒ©)</label><input type="number" id="meg120"></div>
        </div>
        <button class="btn btn-primary" onclick="addMeg()">‚ûï Adicionar Medi√ß√£o</button>
        <table id="megTab">
            <thead><tr><th>Ponto</th><th>30s</th><th>60s</th><th>120s</th><th>IA</th><th>IP</th></tr></thead>
            <tbody id="megCorpo"></tbody>
        </table>
    </div>

    <div id="secMIC" class="glass section">
        <div class="input-group">
            <div class="field"><label>Fase</label><input type="text" id="micF"></div>
            <div class="field"><label>R. Medida (¬µŒ©)</label><input type="number" id="micR"></div>
            <div class="field"><label>Temp. Enrol. (¬∞C)</label><input type="number" id="micT" value="25"></div>
            <div class="field"><label>Material</label><select id="micK"><option value="234.5">Cobre</option><option value="225">Alum√≠nio</option></select></div>
        </div>
        <button class="btn btn-primary" onclick="addMic()">‚ûï Adicionar Medi√ß√£o</button>
        <table>
            <thead><tr><th>Fase</th><th>R. Medida</th><th>R @ 75¬∞C</th></tr></thead>
            <tbody id="micCorpo"></tbody>
        </table>
    </div>

    <div id="secHIST" class="glass section">
        <div id="histLista"></div>
    </div>

    <div id="secCONFIG" class="glass section">
        <div class="input-group">
            <div class="field"><label>Novo T√©cnico</label><input type="text" id="inTec"><button class="btn btn-outline" onclick="saveC('tecnicos','inTec')">Add</button></div>
            <div class="field"><label>Novo Local</label><input type="text" id="inLoc"><button class="btn btn-outline" onclick="saveC('locais','inLoc')">Add</button></div>
        </div>
        <button class="btn btn-danger" onclick="limparSistema()">Resetar Banco de Dados</button>
    </div>

    <div class="no-print" style="margin-top: 30px; display: flex; gap: 15px;">
        <button class="btn btn-primary" style="flex: 2; background: var(--success);" onclick="salvarGeral()">üíæ SALVAR NO HIST√ìRICO</button>
        <button class="btn btn-outline" style="flex: 1;" onclick="window.print()">üñ®Ô∏è RELAT√ìRIO PDF</button>
    </div>
</div>

<script>
    // --- L√ìGICA DE NAVEGA√á√ÉO ---
    function abrirS(id) {
        document.querySelectorAll('.section').forEach(s => {
            if(s.id !== 'cabecalho') s.style.display = 'none';
        });
        document.getElementById('sec'+id).style.display = 'block';
        if(id === 'HIST') renderHist();
    }

    // --- TTR ENGINE ---
    const TTR_MODES = {
        Ydn: (u1, u2) => (u1 * 1.73205) / u2,
        Dyn: (u1, u2) => (u1 * 1.73205) / u2,
        Ynyn: (u1, u2) => u1 / u2,
        Dd: (u1, u2) => u1 / u2
    };
    const TTR_PHASES = ["1U-1V / 2U-2V", "1V-1W / 2V-2W", "1W-1U / 2W-2U"];

    function initTTR() {
        const corpo = document.getElementById('ttrCorpo');
        corpo.innerHTML = TTR_PHASES.map(f => `<tr><td>${f}</td><td><input type="number" class="ttr-val" oninput="runTTR()" style="width:100px"></td><td class="ttr-d">-</td><td class="ttr-s">-</td></tr>`).join('');
        runTTR();
    }

    function runTTR() {
        const u1 = parseFloat(document.getElementById('ttrU1').value);
        const u2 = parseFloat(document.getElementById('ttrU2').value);
        const grp = document.getElementById('ttrGrp').value;
        if(!u1 || !u2 || !grp) return;

        const teo = TTR_MODES[grp](u1, u2);
        document.getElementById('ttrDisplay').innerText = `Rela√ß√£o Te√≥rica: ${teo.toFixed(4)}`;

        document.querySelectorAll('.ttr-val').forEach((inp, i) => {
            const med = parseFloat(inp.value);
            const tr = inp.closest('tr');
            if(med) {
                const desv = ((med - teo) / teo * 100).toFixed(3);
                tr.querySelector('.ttr-d').innerText = desv + "%";
                const ok = Math.abs(desv) <= 0.5;
                tr.querySelector('.ttr-s').innerHTML = `<span class="badge ${ok?'badge-ok':'badge-err'}">${ok?'DENTRO':'FORA'}</span>`;
            }
        });
    }

    // --- MEG√îMETRO ---
    function addMeg() {
        const p = document.getElementById('megPonto').value;
        const v = document.getElementById('megV').value;
        const m30 = parseFloat(document.getElementById('meg30').value);
        const m60 = parseFloat(document.getElementById('meg60').value);
        const m120 = parseFloat(document.getElementById('meg120').value);
        if(!m30 || !m60) return;
        const ia = (m60/m30).toFixed(2);
        const ip = m120 ? (m120/m60).toFixed(2) : "-";
        document.getElementById('megCorpo').innerHTML += `<tr><td>${p} (${v}V)</td><td>${m30}</td><td>${m60}</td><td>${m120||'-'}</td><td>${ia}</td><td>${ip}</td></tr>`;
    }

    // --- MICRO ---
    function addMic() {
        const f = document.getElementById('micF').value;
        const r = parseFloat(document.getElementById('micR').value);
        const t = parseFloat(document.getElementById('micT').value);
        const k = parseFloat(document.getElementById('micK').value);
        if(!r) return;
        const r75 = (r * (k + 75) / (k + t)).toFixed(2);
        document.getElementById('micCorpo').innerHTML += `<tr><td>${f}</td><td>${r} ¬µŒ©</td><td>${r75} ¬µŒ©</td></tr>`;
    }

    // --- HIST√ìRICO E PERSIST√äNCIA ---
    function saveC(key, id) {
        const v = document.getElementById(id).value;
        if(!v) return;
        let l = JSON.parse(localStorage.getItem('alpha_'+key) || "[]");
        l.push(v);
        localStorage.setItem('alpha_'+key, JSON.stringify(l));
        document.getElementById(id).value = "";
        loadC();
    }

    function loadC() {
        const t = JSON.parse(localStorage.getItem('alpha_tecnicos') || '["Eng. Respons√°vel"]');
        const l = JSON.parse(localStorage.getItem('alpha_locais') || '["Subesta√ß√£o Principal"]');
        document.querySelectorAll('.setTec').forEach(s => s.innerHTML = t.map(x => `<option>${x}</option>`).join(''));
        document.querySelectorAll('.setLoc').forEach(s => s.innerHTML = l.map(x => `<option>${x}</option>`).join(''));
    }

    function salvarGeral() {
        const data = {
            id: Date.now(),
            tec: document.getElementById('cliTec').value,
            loc: document.getElementById('cliLoc').value,
            eqp: document.getElementById('cliEqp').value,
            dt: document.getElementById('cliData').value,
            ttr: document.getElementById('secTTR').innerHTML,
            meg: document.getElementById('megCorpo').innerHTML,
            mic: document.getElementById('micCorpo').innerHTML
        };
        let h = JSON.parse(localStorage.getItem('alpha_v3_hist') || "[]");
        h.push(data);
        localStorage.setItem('alpha_v3_hist', JSON.stringify(h));
        alert("Ensaio Finalizado e Salvo!");
    }

    function renderHist() {
        const h = JSON.parse(localStorage.getItem('alpha_v3_hist') || "[]");
        const list = document.getElementById('histLista');
        list.innerHTML = h.length ? "" : "Nenhum hist√≥rico encontrado.";
        h.reverse().forEach(e => {
            const d = document.createElement('div');
            d.className = "glass";
            d.style = "padding:15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;";
            d.innerHTML = `
                <div><b>${e.eqp}</b> - ${e.loc}<br><small>${e.dt.split('-').reverse().join('/')} | ${e.tec}</small></div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-primary" style="padding:5px 10px;" onclick="loadJob(${e.id})">üìÇ</button>
                    <button class="btn btn-danger" style="padding:5px 10px;" onclick="delJob(${e.id})">üóëÔ∏è</button>
                </div>`;
            list.appendChild(d);
        });
    }

    function loadJob(id) {
        const h = JSON.parse(localStorage.getItem('alpha_v3_hist') || "[]");
        const e = h.find(x => x.id === id);
        document.getElementById('cliEqp').value = e.eqp;
        document.getElementById('cliData').value = e.dt;
        document.getElementById('secTTR').innerHTML = e.ttr;
        document.getElementById('megCorpo').innerHTML = e.meg;
        document.getElementById('micCorpo').innerHTML = e.mic;
        abrirS('TTR');
    }

    function delJob(id) {
        if(!confirm("Excluir este ensaio?")) return;
        let h = JSON.parse(localStorage.getItem('alpha_v3_hist') || "[]");
        h = h.filter(x => x.id !== id);
        localStorage.setItem('alpha_v3_hist', JSON.stringify(h));
        renderHist();
    }

    function limparSistema() { if(confirm("Apagar TUDO?")) { localStorage.clear(); location.reload(); } }

    window.onload = () => {
        loadC();
        document.getElementById('cliData').valueAsDate = new Date();
    };
</script>

</body>
</html>
