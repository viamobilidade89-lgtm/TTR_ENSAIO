<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALPHA TTR - ESPECIALISTA DE CAMPO</title>
    <style>
        :root { --fundo: #0f172a; --card: #1e293b; --primaria: #38bdf8; --texto: #f8fafc; --erro: #ff4d4d; --sucesso: #00e676; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--fundo); color: var(--texto); margin: 0; padding: 10px; line-height: 1.4; }
        .container { max-width: 900px; margin: auto; }
        .card { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid #334155; box-shadow: 0 10px 25px rgba(0,0,0,0.4); }
        h2 { color: var(--primaria); text-align: center; margin-bottom: 20px; text-transform: uppercase; font-size: 1.2em; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        .grade { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-bottom: 15px; }
        label { display: block; margin-bottom: 4px; font-weight: bold; font-size: 0.75em; color: var(--primaria); text-transform: uppercase; }
        input, select { width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 6px; box-sizing: border-box; font-size: 0.9em; }
        .info-teorica { background: rgba(56, 189, 248, 0.15); padding: 15px; border-radius: 8px; border-left: 5px solid var(--primaria); margin: 15px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: rgba(0,0,0,0.2); }
        th, td { border: 1px solid #334155; padding: 10px; text-align: center; font-size: 0.85em; }
        th { background: #0f172a; color: var(--primaria); font-size: 0.75em; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; text-transform: uppercase; font-size: 0.7em; }
        .reprovado { background: var(--erro); color: white; }
        .satisfatorio { background: var(--sucesso); color: #0f172a; }
        .btn-print { background: var(--primaria); color: #0f172a; width: 100%; padding: 15px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; transition: 0.2s; }
        .btn-print:hover { background: #7dd3fc; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>Alpha Team - Ensaio de TTR</h2>
        
        <div class="grade">
            <div><label>TAG/Equipamento</label><input id="tag" type="text" placeholder="Ex: TR-02"></div>
            <div><label>Nº de Série</label><input id="serie" type="text" placeholder="Ex: 2024-001"></div>
            <div><label>Técnico</label><input id="tec" type="text" placeholder="Nome"></div>
        </div>

        <div class="grade">
            <div style="grid-column: span 2;">
                <label>Grupo Fasorial</label>
                <select id="selFas" onchange="configurarBornes()">
                    <option value="">-- Selecione o Grupo --</option>
                    <option value="Ydn1_11_X0">Ydn1/Ydn11 (C/ X0 Aparente)</option>
                    <option value="Ydn1_11_H0">Ydn1/Ydn11 (C/ H0 Aparente)</option>
                    <option value="Yd1_H0">Yd1 (S/ H0 Aparente)</option>
                    <option value="Yd11_H0">Yd11 (S/ H0 Aparente)</option>
                    <option value="Dyn1_11_X0">Dyn1/Dyn11 (C/ X0 Aparente)</option>
                    <option value="Dyn1_11_H0">Dyn1/Dyn11 (C/ H0 Aparente)</option>
                    <option value="Dy1_X0">Dy1 (S/ X0 Aparente)</option>
                    <option value="Dy11_X0">Dy11 (S/ X0 Aparente)</option>
                    <option value="Yyn0_H0">Yyn0 (S/ H0 Aparente)</option>
                    <option value="Ynyn0">Ynyn0 (C/ H0 e X0 Aparente)</option>
                    <option value="Yyn0_Dd0">Yyn0 e Dd0 (Direto)</option>
                </select>
            </div>
            <div><label>U1 Nominal</label><input id="u1" type="number" oninput="calcularTeorico()"></div>
            <div><label>U2 Nominal</label><input id="u2" type="number" oninput="calcularTeorico()"></div>
        </div>

        <div id="boxTeorico" class="info-teorica" style="display:none;">
            <b>VALOR TEÓRICO:</b> <span id="valTeo" style="color:var(--primaria); font-size: 1.2em;">0.0000</span><br>
            <small id="limites" style="opacity: 0.8;"></small>
        </div>

        <div id="areaEnsaio" style="display:none;">
            <table>
                <thead>
                    <tr>
                        <th>Ponto de Ensaio (Entrada/Saída)</th>
                        <th>Valor Medido (TTR)</th>
                        <th>Desvio %</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela"></tbody>
            </table>
            <button class="btn-print" onclick="window.print()">IMPRIMIR RELATÓRIO</button>
        </div>
    </div>
</div>

<script>
    const REGRAS = {
        "Ydn1_11_X0": { f: (u1, u2) => (u1 * 1.732) / u2, h: ["H1-H3", "H1-H2", "H3-H1"], x: ["X1-X0", "X2-X0", "X3-X0"] },
        "Ydn1_11_H0": { f: (u1, u2) => u1 / (u2 * 1.732), h: ["H1-H0", "H2-H0", "H3-H0"], x: ["X1-X3", "X2-X1", "X3-X2"] },
        "Yd1_H0":     { f: (u1, u2) => 0.866 * (u1 / u2), h: ["H2-H1~H3", "H3-H2~H1", "H1-H3~H2"], x: ["X2-X3", "X3-X1", "X1-X2"] },
        "Yd11_H0":    { f: (u1, u2) => 0.866 * (u1 / u2), h: ["H1-H1~H3", "H2-H3~H1", "H3-H1~H2"], x: ["X1-X3", "X3-X1", "X3-X2"] },
        "Dyn1_11_X0": { f: (u1, u2) => (u1 * 1.732) / u2, h: ["H1-H3", "H2-H1", "H3-H2"], x: ["X1-X0", "X2-X0", "X3-X0"] },
        "Dyn1_11_H0": { f: (u1, u2) => u1 / (u2 * 1.732), h: ["H1-H0", "H2-H0", "H3-H0"], x: ["X1-X3", "X2-X1", "X3-X2"] },
        "Dy1_X0":     { f: (u1, u2) => u1 / (0.866 * u2), h: ["H2-H1", "H3-H2", "H1-H3"], x: ["X2-X1~X3", "X3-X2~X1", "X1-X3~X2"] },
        "Dy11_X0":    { f: (u1, u2) => u1 / (0.866 * u2), h: ["H1-H2", "H2-H3", "H3-H1"], x: ["X1-X2~X3", "X2-X3~X1", "X1-X3~X2"] },
        "Yyn0_H0":    { f: (u1, u2) => (u1 * 1.732) / (u2 * 0.866), h: ["H1-H2~H3", "H2-H3~H1", "H3-H1~H2"], x: ["X1-X0", "X2-X0", "X3-X0"] },
        "Ynyn0":      { f: (u1, u2) => u1 / u2, h: ["H1-H0", "H2-H0", "H3-H0"], x: ["X1-X0", "X2-X0", "X3-X0"] },
        "Yyn0_Dd0":   { f: (u1, u2) => u1 / u2, h: ["H1-H2", "H2-H3", "H3-H1"], x: ["X1-X2", "X2-X3", "X3-X1"] }
    };

    let vTeoGlobal = 0;

    function configurarBornes() {
        const fas = document.getElementById('selFas').value;
        if (!fas) return;
        const config = REGRAS[fas];
        const tbody = document.getElementById('corpoTabela');
        tbody.innerHTML = "";
        
        config.h.forEach((h, i) => {
            tbody.innerHTML += `
                <tr>
                    <td><b>${h}</b> (E) / <b>${config.x[i]}</b> (S)</td>
                    <td><input type="number" step="any" class="input-med" oninput="validar(this)"></td>
                    <td class="res-erro">-</td>
                    <td><span class="status-badge">Pendente</span></td>
                </tr>`;
        });
        document.getElementById('areaEnsaio').style.display = 'block';
        document.getElementById('boxTeorico').style.display = 'block';
        calcularTeorico();
    }

    function calcularTeorico() {
        const u1 = parseFloat(document.getElementById('u1').value);
        const u2 = parseFloat(document.getElementById('u2').value);
        const fas = document.getElementById('selFas').value;
        if (u1 && u2 && fas) {
            vTeoGlobal = REGRAS[fas].f(u1, u2);
            document.getElementById('valTeo').innerText = vTeoGlobal.toFixed(5);
            document.getElementById('limites').innerText = `Tolerância ±0.5%: ${(vTeoGlobal*0.995).toFixed(4)} até ${(vTeoGlobal*1.005).toFixed(4)}`;
            document.querySelectorAll('.input-med').forEach(inp => validar(inp));
        }
    }

    function validar(input) {
        if (!vTeoGlobal) return;
        const medido = parseFloat(input.value);
        const linha = input.closest('tr');
        const cErro = linha.querySelector('.res-erro');
        const cStat = linha.querySelector('.status-badge');

        if (isNaN(medido)) {
            cErro.innerText = "-"; cStat.innerText = "Pendente"; cStat.className = "status-badge";
            return;
        }

        const erro = ((medido - vTeoGlobal) / vTeoGlobal) * 100;
        cErro.innerText = erro.toFixed(3) + "%";

        if (Math.abs(erro) <= 0.5) {
            cStat.innerText = "Satisfeito"; cStat.className = "status-badge satisfatorio";
        } else {
            cStat.innerText = "Reprovado"; cStat.className = "status-badge reprovado";
        }
    }
</script>
</body>
</html>
