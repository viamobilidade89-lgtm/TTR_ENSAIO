<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALPHA TTR - MULTI-FASORIAL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <style>
        :root { 
            --cor-fundo: #0f172a; --cor-card: rgba(30, 41, 59, 0.95); --cor-primaria: #38bdf8; 
            --cor-texto: #f8fafc; --fonte-tam: 14px;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; font-size: var(--fonte-tam);
            background: var(--cor-fundo); color: var(--cor-texto); margin: 0; padding: 15px; 
        }
        
        .container { max-width: 900px; margin: auto; }
        .card { background: var(--cor-card); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); position: relative; }
        
        .secao-titulo { text-align: center; border-bottom: 1px solid rgba(56, 189, 248, 0.2); margin-bottom: 20px; }
        .grade { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.85em; color: var(--cor-primaria); text-transform: uppercase; }
        input, select { 
            width: 100%; padding: 12px; margin: 5px 0 10px; background: rgba(0,0,0,0.3); 
            border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: inherit; box-sizing: border-box;
        }
        
        .info-conexao { 
            background: rgba(56, 189, 248, 0.15); padding: 15px; border-radius: 10px; 
            border: 1px dashed var(--cor-primaria); margin-bottom: 20px; font-size: 0.9em;
        }

        button { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-calc { background: var(--cor-primaria); color: #000; width: 100%; font-size: 1.1em; margin-top: 15px; }
        
        .res-caixa { background: rgba(0,0,0,0.4); padding: 15px; border-radius: 10px; border-top: 4px solid var(--cor-primaria); }
        .badge { background: var(--cor-primaria); color: #000; padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 0.8em; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <header class="secao-titulo">
            <h1 id="tituloTTR" style="color:var(--cor-primaria); margin-bottom:5px;">TTR - CONFIGURAÇÃO POR GRUPO VETORIAL</h1>
            <p style="opacity:0.7; margin-top:0;">EQUIPE ALPHA - ENGENHARIA DE CAMPO</p>
        </header>

        <div class="grade">
            <div>
                <label>Selecione o Fasorial</label>
                <select id="selFasorial" onchange="configurarBornes()">
                    <optgroup label="Delta-Estrela (Comum)">
                        <option value="Dyn1">Dyn1 (330°)</option>
                        <option value="Dyn11" selected>Dyn11 (30°)</option>
                    </optgroup>
                    <optgroup label="Estrela-Delta">
                        <option value="Ynd1">Ynd1 (330°)</option>
                        <option value="Ynd11">Ynd11 (30°)</option>
                    </optgroup>
                    <optgroup label="Estrela-Estrela / Delta-Delta">
                        <option value="Yyn0">Yyn0 (0°)</option>
                        <option value="Ynyn0">Ynyn0 (0°)</option>
                        <option value="Dd0">Dd0 (0°)</option>
                    </optgroup>
                </select>
            </div>
            <div><label>Temperatura Ensaio (°C)</label><input id="tempMed" type="number" value="25"></div>
        </div>

        <div class="info-conexao" id="infoConexao">
            </div>

        <div class="grade">
            <section>
                <h3 style="color:var(--cor-primaria); font-size: 0.9em;">ALTA TENSÃO (Ω)</h3>
                <label id="lH1">Fase A</label><input id="h1" type="number" step="any">
                <label id="lH2">Fase B</label><input id="h2" type="number" step="any">
                <label id="lH3">Fase C</label><input id="h3" type="number" step="any">
            </section>
            <section>
                <h3 style="color:var(--cor-primaria); font-size: 0.9em;">BAIXA TENSÃO (mΩ)</h3>
                <label id="lX1">Fase a</label><input id="x1" type="number" step="any">
                <label id="lX2">Fase b</label><input id="x2" type="number" step="any">
                <label id="lX3">Fase c</label><input id="x3" type="number" step="any">
            </section>
        </div>

        <button class="btn-calc" onclick="calcular()">CALCULAR E APLICAR CORREÇÃO</button>
        
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button style="flex:1; background:#334155; color:white" onclick="location.reload()">REINICIAR</button>
            <button style="flex:1; background:#4f46e5; color:white" onclick="gerarPDF()">GERAR PDF</button>
        </div>
    </div>

    <div id="areaRes" class="grade" style="display:none; margin-top:20px;">
        <div class="res-caixa"><b>Alta Tensão (75°C)</b><div id="reH" style="font-family:monospace; margin-top:10px"></div></div>
        <div class="res-caixa"><b>Baixa Tensão (75°C)</b><div id="reX" style="font-family:monospace; margin-top:10px"></div></div>
    </div>
</div>

<script>
    const configuracoes = {
        "Dyn11": { info: "Conexão: H1-H3 / X0-X1 | H2-H1 / X0-X2 | H3-H2 / X0-X3", h: ["H1-H3", "H2-H1", "H3-H2"], x: ["X0-X1", "X0-X2", "X0-X3"], kH: 1.5 },
        "Dyn1":  { info: "Conexão: H1-H2 / X0-X1 | H2-H3 / X0-X2 | H3-H1 / X0-X3", h: ["H1-H2", "H2-H3", "H3-H1"], x: ["X0-X1", "X0-X2", "X0-X3"], kH: 1.5 },
        "Ynd11": { info: "Conexão: H1-H0 / X1-X3 | H2-H0 / X2-X1 | H3-H0 / X3-X2", h: ["H1-H0", "H2-H0", "H3-H0"], x: ["X1-X3", "X2-X1", "X3-X2"], kH: 1.0 },
        "Ynd1":  { info: "Conexão: H1-H0 / X1-X2 | H2-H0 / X2-X3 | H3-H0 / X3-X1", h: ["H1-H0", "H2-H0", "H3-H0"], x: ["X1-X2", "X2-X3", "X3-X1"], kH: 1.0 },
        "Yyn0":  { info: "Conexão direta: H1-H0 / X1-X0 | H2-H0 / X2-X0 | H3-H0 / X3-X0", h: ["H1-H0", "H2-H0", "H3-H0"], x: ["X1-X0", "X2-X0", "X3-X0"], kH: 1.0 },
        "Ynyn0": { info: "Conexão Neutro-Neutro: H1-N / X1-n | H2-N / X2-n | H3-N / X3-n", h: ["H1-N", "H2-N", "H3-N"], x: ["X1-n", "X2-n", "X3-n"], kH: 1.0 },
        "Dd0":   { info: "Conexão Delta-Delta: H1-H3 / X1-X3 | H2-H1 / X2-X1 | H3-H2 / X3-X2", h: ["H1-H3", "H2-H1", "H3-H2"], x: ["X1-X3", "X2-X1", "X3-X2"], kH: 1.5 }
    };

    function configurarBornes() {
        const fas = document.getElementById('selFasorial').value;
        const c = configuracoes[fas];
        
        document.getElementById('infoConexao').innerHTML = `<b>Orientação Técnica:</b> ${c.info}`;
        
        // Atualiza Labels dos inputs
        document.getElementById('lH1').innerText = c.h[0];
        document.getElementById('lH2').innerText = c.h[1];
        document.getElementById('lH3').innerText = c.h[2];
        
        document.getElementById('lX1').innerText = c.x[0];
        document.getElementById('lX2').innerText = c.x[1];
        document.getElementById('lX3').innerText = c.x[2];
    }

    function calcular() {
        const t = parseFloat(document.getElementById('tempMed').value);
        const fas = document.getElementById('selFasorial').value;
        const c = configuracoes[fas];
        const fator = (235 + 75) / (235 + t);
        
        const hVal = [
            (parseFloat(document.getElementById('h1').value) || 0) * fator * c.kH,
            (parseFloat(document.getElementById('h2').value) || 0) * fator * c.kH,
            (parseFloat(document.getElementById('h3').value) || 0) * fator * c.kH
        ];

        const xVal = [
            (parseFloat(document.getElementById('x1').value) || 0) * 0.001 * fator,
            (parseFloat(document.getElementById('x2').value) || 0) * 0.001 * fator,
            (parseFloat(document.getElementById('x3').value) || 0) * 0.001 * fator
        ];

        document.getElementById('areaRes').style.display = 'grid';
        document.getElementById('reH').innerHTML = hVal.map((v, i) => `<span>${c.h[i]}:</span> <b>${v.toFixed(4)} Ω</b><br>`).join("");
        document.getElementById('reX').innerHTML = xVal.map((v, i) => `<span>${c.x[i]}:</span> <b>${(v*1000).toFixed(4)} mΩ</b><br>`).join("");
    }

    window.onload = configurarBornes;
</script>
</body>
</html>
